<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="boardMapper">
<!-- bno 필드 변수가 자동증가가 되는 기능이 필요 seq.nextVal -->
<insert id="insertBoard">
	<selectKey keyProperty="bno" resultType="int" order="BEFORE">
	select seq_bno.nextval from dual
	</selectKey>
	insert into tbl_board
	(
	bno, title, content, writer, reg_date, board_type
	)
	values
	(
	#{bno},#{title},#{content},#{writer},#{reg_date},systimestamp,#{board_type}
	)
</insert>
<!-- 페이징 처리때문에 중첩쿼리 생성(아래) -->
<select id="selectBoard" resultType="com.edu.vo.BoardVO">
select table_b. * from
(
	select rownum as rnum, table_a * from
	(
		select * from tbl_board
		<include refid="sqlWhere"></include>
	) table_a
	<![CDATA[
	where rownum <= (#{queryStartNO}*#{queryPerPageNum})+#{queryPerPageNum}
) table_b where table_b.rnum > #{queryStartNO}*#{queryPerPageNum}
	]]>
</select>
<!-- 검색처리는 멤버 쿼리에서 작성한 내용 붙여넣기 다중 게시판용 필드조회 조건 추가예정? -->
<sql id="sqlWhere">
	<if test ="search_type != '' and search_type !=null">
		WHERE
       
		<if test ="search_type == 'all'.toString()">
			user_id LIKE '%'||#{search_keyword}||'%' 
			OR user_name LIKE '%'||#{search_keyword}||'%'
		</if>
		<if test ="search_type == 'title'.toString()">
			user_id LIKE '%'||#{search_keyword}||'%' 
		</if>
		<if test ="search_type == 'content'.toString()">
			user_name LIKE '%'||#{search_keyword}||'%'
		</if>
	</if>
</sql>

</mapper>